# å‰åç«¯è”è°ƒæµ‹è¯•è„šæœ¬

## âœ… å·²å®Œæˆé…ç½®

1. **å‰ç«¯é…ç½®**
   - âœ… APIåœ°å€: `http://localhost:3000`
   - âœ… Mockæ¨¡å¼å·²å…³é—­ï¼ˆ`return false`ï¼‰
   - âœ… ä½ç½®: `fonted/utils/mock.js`

2. **åç«¯é…ç½®**
   - âœ… ç«¯å£: `3000`
   - âœ… CORSå·²å¯ç”¨
   - âœ… æ•°æ®åº“: `SM`

---

## å¿«é€Ÿæµ‹è¯•æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```powershell
# æ‰“å¼€PowerShellï¼Œè¿›å…¥åç«¯ç›®å½•
cd "d:\åŸºäºå›½å¯†åŠ å¯†çš„ç½‘ä¸Šçœ‹è¯Šç³»ç»Ÿ\backed"

# å¯åŠ¨åç«¯æœåŠ¡
go run cmd/main.go
```

**é¢„æœŸè¾“å‡º**ï¼š
```
Crypto initialized successfully
[GIN-debug] Listening and serving HTTP on :3000
Server is running on :3000
Environment: debug
```

âœ… **éªŒè¯**: æµè§ˆå™¨è®¿é—® `http://localhost:3000`ï¼Œåº”è¯¥çœ‹åˆ°å“åº”ï¼ˆå³ä½¿æ˜¯404ä¹Ÿè¯´æ˜æœåŠ¡æ­£å¸¸ï¼‰

---

### ç¬¬äºŒæ­¥ï¼šæµ‹è¯•åç«¯APIï¼ˆå¯é€‰ï¼‰

åœ¨æµè§ˆå™¨æ§åˆ¶å°æˆ–æ–°çš„PowerShellçª—å£æµ‹è¯•ï¼š

```powershell
# æµ‹è¯•è·å–SM2å…¬é’¥ï¼ˆå…¬å¼€æ¥å£ï¼‰
curl http://localhost:3000/api/crypto/public-key?keyType=sm2

# é¢„æœŸè¿”å›ï¼š
# {"code":200,"message":"è·å–æˆåŠŸ","data":{"keyType":"sm2","publicKey":"..."}}
```

æˆ–è€…ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:3000/api/crypto/public-key?keyType=sm2
```

âœ… **éªŒè¯**: èƒ½çœ‹åˆ°JSONæ ¼å¼çš„è¿”å›æ•°æ®

---

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å‰ç«¯é¡¹ç›®

**æ–¹å¼ä¸€ï¼šä½¿ç”¨HBuilderX**
1. ç”¨HBuilderXæ‰“å¼€ `fonted` ç›®å½•
2. ç‚¹å‡»"è¿è¡Œ" -> "è¿è¡Œåˆ°æµè§ˆå™¨" -> "Chrome"

**æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆå¦‚æœæ˜¯uni-app CLIé¡¹ç›®ï¼‰**
```powershell
cd "d:\åŸºäºå›½å¯†åŠ å¯†çš„ç½‘ä¸Šçœ‹è¯Šç³»ç»Ÿ\fonted"
npm run dev:h5
```

âœ… **éªŒè¯**: å‰ç«¯é¡µé¢èƒ½æ­£å¸¸æ‰“å¼€

---

### ç¬¬å››æ­¥ï¼šæµ‹è¯•ç™»å½•åŠŸèƒ½

#### æµ‹è¯•1ï¼šä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦å·

**å‰ç«¯æ“ä½œ**ï¼š
1. æ‰“å¼€ç™»å½•é¡µé¢
2. è¾“å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`Admin123!@#`
3. ç‚¹å‡»ç™»å½•

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç™»å½•æˆåŠŸ
- âœ… è·³è½¬åˆ°é¦–é¡µ
- âœ… æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

**åç«¯æ—¥å¿—**ï¼š
```
[GIN] POST /api/user/login
Status: 200
```

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å° Network æ ‡ç­¾
- æŸ¥çœ‹è¯·æ±‚URLæ˜¯å¦ä¸º `http://localhost:3000/api/user/login`
- æŸ¥çœ‹è¯·æ±‚çŠ¶æ€ç 

#### æµ‹è¯•2ï¼šæŸ¥çœ‹è¯·æ±‚è¯¦æƒ…

**åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­**ï¼š
1. æ‰“å¼€ Networkï¼ˆç½‘ç»œï¼‰æ ‡ç­¾
2. ç­›é€‰ XHR è¯·æ±‚
3. æ‰¾åˆ° `/api/user/login` è¯·æ±‚
4. æŸ¥çœ‹ï¼š
   - Request URL: åº”è¯¥æ˜¯ `http://localhost:3000/api/user/login`
   - Request Headers: `Content-Type: application/json`
   - Request Payload: åŒ…å« username å’Œ password
   - Response: `{"code":200,"message":"ç™»å½•æˆåŠŸ",...}`

---

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£

#### æµ‹è¯•ï¼šè·å–ç”¨æˆ·ä¿¡æ¯

**å‰ç«¯æ“ä½œ**ï¼š
1. ç™»å½•æˆåŠŸå
2. è¿›å…¥"æˆ‘çš„"é¡µé¢
3. åº”è¯¥è‡ªåŠ¨è°ƒç”¨ `/api/user/info`

**éªŒè¯ç‚¹**ï¼š
- âœ… è¯·æ±‚å¤´åŒ…å« `Authorization: Bearer <token>`
- âœ… è¿”å›ç”¨æˆ·ä¿¡æ¯
- âœ… æ•æ„Ÿä¿¡æ¯ï¼ˆé‚®ç®±ã€æ‰‹æœºå·ï¼‰æ­£ç¡®æ˜¾ç¤º

**åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹**ï¼š
```
Request URL: http://localhost:3000/api/user/info
Request Headers:
  Authorization: Bearer eyJhbGci...
Response:
  {"code":200,"data":{"userId":1,"username":"admin",...}}
```

---

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•åŒ»ç”Ÿåˆ—è¡¨

**å‰ç«¯æ“ä½œ**ï¼š
1. è¿›å…¥"æ‰¾åŒ»ç”Ÿ"é¡µé¢
2. æŸ¥çœ‹åŒ»ç”Ÿåˆ—è¡¨

**APIè°ƒç”¨**ï¼š
```
GET http://localhost:3000/api/user/doctors?page=1&pageSize=10
```

**éªŒè¯ç‚¹**ï¼š
- âœ… è¿”å›åŒ»ç”Ÿåˆ—è¡¨ï¼ˆå¯èƒ½ä¸ºç©ºï¼Œå› ä¸ºè¿˜æ²¡æœ‰åŒ»ç”Ÿæ•°æ®ï¼‰
- âœ… åˆ†é¡µå‚æ•°æ­£ç¡®ä¼ é€’

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total": 0,
    "page": 1,
    "pageSize": 10,
    "list": []
  }
}
```

---

## å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šç™»å½•å¤±è´¥ - å¯†ç é”™è¯¯

**ç—‡çŠ¶**ï¼š
```json
{"code":401,"message":"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"}
```

**åŸå› **ï¼šå¯†ç éœ€è¦å‰ç«¯SM3åŠ å¯†

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥å‰ç«¯ç™»å½•ä»£ç ï¼Œç¡®ä¿å¯†ç ç»è¿‡SM3åŠ å¯†ï¼š
```javascript
import { sm3Hash } from '@/utils/crypto.js'

const encryptedPassword = sm3Hash(password)
// ç„¶åå‘é€ encryptedPassword åˆ°åç«¯
```

### é—®é¢˜2ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Network Error
ERR_CONNECTION_REFUSED
```

**æ’æŸ¥æ­¥éª¤**ï¼š
1. âœ… æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ˆPowerShellçª—å£è¿˜åœ¨è¿è¡Œï¼‰
2. âœ… æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆå¯èƒ½3000ç«¯å£è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼‰
3. âœ… æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

**æµ‹è¯•ç«¯å£æ˜¯å¦å¯ç”¨**ï¼š
```powershell
# æŸ¥çœ‹3000ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :3000
```

### é—®é¢˜3ï¼šCORSè·¨åŸŸé”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Access to XMLHttpRequest blocked by CORS policy
```

**åŸå› **ï¼šåç«¯CORSé…ç½®é—®é¢˜ï¼ˆæ­£å¸¸æƒ…å†µä¸åº”å‡ºç°ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥ `backed/internal/middleware/auth.go` ä¸­çš„CORSé…ç½®æ˜¯å¦æ­£ç¡®åŠ è½½

### é—®é¢˜4ï¼šTokenæœªæºå¸¦

**ç—‡çŠ¶**ï¼š
```json
{"code":401,"message":"è¯·å…ˆç™»å½•"}
```

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥ç™»å½•åTokenæ˜¯å¦ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
   ```javascript
   console.log(uni.getStorageSync('token'))
   ```

2. æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦æºå¸¦Token
   ```javascript
   // åœ¨request.jsä¸­æ·»åŠ æ—¥å¿—
   console.log('Authorization:', header['Authorization'])
   ```

### é—®é¢˜5ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Failed to init database: Error 1045: Access denied
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ•°æ®åº“é…ç½® `backed/config/config.yaml`
2. ç¡®è®¤æ•°æ®åº“ç”¨æˆ·åå¯†ç æ­£ç¡®
3. ç¡®è®¤æ•°æ®åº“å·²åˆ›å»ºï¼ˆæ‰§è¡Œinit.sqlï¼‰

```sql
-- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
SHOW DATABASES LIKE 'SM';

-- æ£€æŸ¥ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'sm_admin'@'localhost';
```

---

## å®Œæ•´æµ‹è¯•æ£€æŸ¥è¡¨

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] å‰ç«¯é¡¹ç›®å¯åŠ¨æˆåŠŸ
- [ ] APIåœ°å€é…ç½®æ­£ç¡®
- [ ] Mockæ¨¡å¼å·²å…³é—­

### ç”¨æˆ·æ¨¡å—æµ‹è¯•

- [ ] ç”¨æˆ·æ³¨å†Œ
  - [ ] æ³¨å†ŒæˆåŠŸ
  - [ ] ç”¨æˆ·åé‡å¤æ£€æµ‹
  - [ ] å¯†ç å¼ºåº¦éªŒè¯
  - [ ] é‚®ç®±æ ¼å¼éªŒè¯

- [ ] ç”¨æˆ·ç™»å½•
  - [ ] ç™»å½•æˆåŠŸ
  - [ ] Tokenæ­£ç¡®è¿”å›
  - [ ] Tokenä¿å­˜åˆ°æœ¬åœ°
  - [ ] é”™è¯¯å¯†ç æç¤º

- [ ] ç”¨æˆ·ä¿¡æ¯
  - [ ] è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  - [ ] æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  - [ ] ä¿®æ”¹å¯†ç 

### åŒ»ç”Ÿæ¨¡å—æµ‹è¯•

- [ ] åŒ»ç”Ÿåˆ—è¡¨
  - [ ] è·å–æ‰€æœ‰åŒ»ç”Ÿ
  - [ ] åˆ†é¡µåŠŸèƒ½
  - [ ] ç§‘å®¤ç­›é€‰

- [ ] åŒ»ç”Ÿè¯¦æƒ…
  - [ ] æŸ¥çœ‹åŒ»ç”Ÿè¯¦æƒ…

- [ ] ç”³è¯·åŒ»ç”Ÿè®¤è¯
  - [ ] ä¸Šä¼ è¯ä¹¦
  - [ ] æäº¤ç”³è¯·
  - [ ] æŸ¥è¯¢ç”³è¯·çŠ¶æ€

### ç®¡ç†å‘˜æ¨¡å—æµ‹è¯•

- [ ] ç®¡ç†å‘˜ç™»å½•ï¼ˆä½¿ç”¨adminè´¦å·ï¼‰
- [ ] æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
- [ ] æŸ¥çœ‹åŒ»ç”Ÿç”³è¯·åˆ—è¡¨
- [ ] å®¡æ ¸åŒ»ç”Ÿç”³è¯·
- [ ] ç¦ç”¨/å¯ç”¨ç”¨æˆ·
- [ ] æŸ¥çœ‹ç™»å½•æ—¥å¿—

### é—®è¯Šæ¨¡å—æµ‹è¯•

- [ ] åˆ›å»ºé—®è¯Š
- [ ] æŸ¥çœ‹é—®è¯Šåˆ—è¡¨
- [ ] æŸ¥çœ‹é—®è¯Šè¯¦æƒ…
- [ ] å‘é€æ¶ˆæ¯
- [ ] å®Œæˆé—®è¯Š

### ç—…å†æ¨¡å—æµ‹è¯•

- [ ] åˆ›å»ºç—…å†
- [ ] æŸ¥çœ‹ç—…å†åˆ—è¡¨
- [ ] æŸ¥çœ‹ç—…å†è¯¦æƒ…
- [ ] ç—…å†è®¿é—®æ§åˆ¶

### é€šçŸ¥æ¨¡å—æµ‹è¯•

- [ ] è·å–é€šçŸ¥åˆ—è¡¨
- [ ] æ ‡è®°å·²è¯»
- [ ] æœªè¯»æ•°é‡ç»Ÿè®¡

---

## æ•°æ®å‡†å¤‡è„šæœ¬

### åˆ›å»ºæµ‹è¯•ç”¨æˆ·

```sql
-- è¿›å…¥æ•°æ®åº“
USE SM;

-- åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼ˆå¯†ç ï¼šTest123!@#ï¼‰
-- æ³¨æ„ï¼šå¯†ç éœ€è¦å…ˆç»è¿‡SM3åŠ å¯†ï¼Œè¿™é‡Œä½¿ç”¨æ˜æ–‡éœ€è¦å‰ç«¯åŠ å¯†åå†æ’å…¥
-- æˆ–è€…é€šè¿‡å‰ç«¯æ³¨å†ŒåŠŸèƒ½åˆ›å»º

-- åˆ›å»ºä¸€ä¸ªåŒ»ç”Ÿç”¨æˆ·ï¼ˆå·²è®¤è¯ï¼‰
INSERT INTO SM_user (
    username, password, email, phone, 
    real_name, identify, status, 
    doctor_title, doctor_dept, doctor_intro,
    gender, age
) VALUES (
    'doctor_test',
    '5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8',  -- Test123!@# çš„SM3å€¼
    'doctor@test.com',  -- éœ€è¦SM4åŠ å¯†
    '13900139000',      -- éœ€è¦SM4åŠ å¯†
    'æµ‹è¯•åŒ»ç”Ÿ',          -- éœ€è¦SM4åŠ å¯†
    'doctor',
    0,
    'ä¸»æ²»åŒ»å¸ˆ',
    'å†…ç§‘',
    'æµ‹è¯•åŒ»ç”Ÿç®€ä»‹',
    1,
    35
);
```

**æ³¨æ„**ï¼šå»ºè®®ä½¿ç”¨å‰ç«¯æ³¨å†Œå’Œç”³è¯·åŠŸèƒ½åˆ›å»ºæµ‹è¯•æ•°æ®ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åŠ å¯†æ­£ç¡®ã€‚

---

## è°ƒè¯•æŠ€å·§

### å‰ç«¯è°ƒè¯•

1. **æŸ¥çœ‹ç½‘ç»œè¯·æ±‚**
   ```javascript
   // æµè§ˆå™¨æ§åˆ¶å° -> Network -> XHR
   // æŸ¥çœ‹æ¯ä¸ªè¯·æ±‚çš„ï¼š
   // - URL
   // - Method
   // - Headersï¼ˆç‰¹åˆ«æ˜¯Authorizationï¼‰
   // - Request Body
   // - Response
   ```

2. **æŸ¥çœ‹æœ¬åœ°å­˜å‚¨**
   ```javascript
   // æµè§ˆå™¨æ§åˆ¶å° -> Application -> Local Storage
   console.log('Token:', uni.getStorageSync('token'))
   console.log('UserInfo:', uni.getStorageSync('userInfo'))
   ```

3. **æ·»åŠ æ—¥å¿—**
   åœ¨ `fonted/utils/request.js` ä¸­æ·»åŠ ï¼š
   ```javascript
   console.log('Request URL:', url)
   console.log('Request Headers:', header)
   console.log('Request Data:', options.data)
   ```

### åç«¯è°ƒè¯•

1. **æŸ¥çœ‹Ginæ—¥å¿—**
   æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæ‰“å°åˆ°æ§åˆ¶å°ï¼š
   ```
   [GIN] 2024/12/04 - 10:30:00 | 200 |    5.123ms |  127.0.0.1 | POST  /api/user/login
   ```

2. **æ·»åŠ æ—¥å¿—**
   åœ¨Handlerä¸­æ·»åŠ ï¼š
   ```go
   log.Printf("Received data: %+v", req)
   log.Printf("User ID: %d", userID)
   ```

3. **æŸ¥è¯¢æ•°æ®åº“**
   ```sql
   -- æŸ¥çœ‹æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·
   SELECT id, username, email, identify, status, created_at 
   FROM SM_user 
   ORDER BY created_at DESC 
   LIMIT 10;
   
   -- æŸ¥çœ‹ç™»å½•æ—¥å¿—
   SELECT user_id, username, status, login_time 
   FROM SM_login_log 
   ORDER BY login_time DESC 
   LIMIT 10;
   ```

---

## ä¸‹ä¸€æ­¥

è”è°ƒæˆåŠŸåï¼Œä½ å¯ä»¥ï¼š

1. **å®Œå–„ä¸šåŠ¡åŠŸèƒ½**
   - å®ç°é—®è¯Šæ¶ˆæ¯å®æ—¶æ¨é€ï¼ˆWebSocketï¼‰
   - å®Œå–„æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
   - é›†æˆAIè¾…åŠ©è¯Šæ–­

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ Redisç¼“å­˜
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
   - å‰ç«¯æ‡’åŠ è½½

3. **å‡†å¤‡éƒ¨ç½²**
   - ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®
   - é…ç½®HTTPS
   - å›½å¯†SSLè¯ä¹¦

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰
