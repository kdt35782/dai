# 注册功能测试指南

## 测试环境准备

### 1. 启动后端服务
```bash
cd backed
go run cmd/main.go
```

### 2. 启动前端服务
使用 HBuilderX 或者命令行启动 uni-app 项目

---

## 测试用例

### 测试用例1: 患者注册

**目的**: 验证患者注册功能

**步骤**:
1. 打开注册页面
2. 默认选择"患者"类型(或点击患者图标)
3. 填写以下信息:
   - 用户名: `patient_test01`
   - 手机号: `13800138001`
   - 邮箱: `patient01@test.com`
   - 密码: `Test@123456`
   - 确认密码: `Test@123456`
4. 勾选同意协议
5. 点击"注册"按钮

**预期结果**:
- ✅ 提示"注册成功"
- ✅ 自动跳转到登录页面
- ✅ 数据库中创建用户记录,role=`patient`

**API请求示例**:
```json
POST /api/user/register
{
  "username": "patient_test01",
  "password": "a8c2e...(SM3加密后的密码)",
  "email": "patient01@test.com",
  "phone": "13800138001",
  "role": "patient"
}
```

---

### 测试用例2: 医生注册 - 完整信息

**目的**: 验证医生注册功能(填写所有字段)

**步骤**:
1. 打开注册页面
2. 点击"医生"类型
3. 填写基本信息:
   - 用户名: `doctor_zhang`
   - 手机号: `13900139001`
   - 邮箱: `zhang@hospital.com`
   - 密码: `Doctor@123`
   - 确认密码: `Doctor@123`
4. 填写医生专业信息:
   - 真实姓名: `张医生`
   - 身份证号: `110101199001011234` (选填)
   - 职称: 选择`主治医师`
   - 科室: 选择`内科`
   - 擅长领域: `心血管疾病、高血压、糖尿病的诊治`
   - 个人介绍: `从事临床工作10年,具有丰富的诊疗经验` (选填)
   - 执业证号: `DOC2024001`
5. 上传执业证书照片
6. 勾选同意协议
7. 点击"注册"按钮

**预期结果**:
- ✅ 提示"注册成功"
- ✅ 自动跳转到登录页面
- ✅ 数据库中创建用户记录:
  - role=`doctor`
  - cert_status=`approved`
  - 敏感信息已SM4加密

**API请求示例**:
```json
POST /api/user/register
{
  "username": "doctor_zhang",
  "password": "b7d3f...(SM3加密后的密码)",
  "email": "zhang@hospital.com",
  "phone": "13900139001",
  "role": "doctor",
  "realName": "张医生",
  "idCard": "110101199001011234",
  "doctorTitle": "主治医师",
  "doctorDept": "内科",
  "specialty": "心血管疾病、高血压、糖尿病的诊治",
  "introduction": "从事临床工作10年,具有丰富的诊疗经验",
  "certNumber": "DOC2024001",
  "certImage": "data:image/jpeg;base64,/9j/4AAQ..."
}
```

---

### 测试用例3: 医生注册 - 必填项验证

**目的**: 验证医生注册必填字段校验

**步骤**:
1. 打开注册页面
2. 点击"医生"类型
3. 仅填写基本信息,不填写医生专业信息
4. 点击"注册"按钮

**预期结果**:
- ✅ 显示错误提示:
  - 缺少姓名: "请输入真实姓名"
  - 缺少职称: "请选择职称"
  - 缺少科室: "请选择科室"
  - 缺少擅长领域: "请输入擅长领域"
  - 缺少执业证号: "请输入执业证号"
  - 缺少证书: "请上传执业证书"
- ✅ 注册失败,不创建用户记录

---

### 测试用例4: 医生登录及权限验证

**目的**: 验证医生注册后可正常登录并拥有医生权限

**步骤**:
1. 使用测试用例2创建的医生账号登录
   - 用户名: `doctor_zhang`
   - 密码: `Doctor@123`
2. 登录后进入用户中心
3. 查看功能菜单

**预期结果**:
- ✅ 登录成功
- ✅ 返回的userInfo包含:
  ```json
  {
    "userId": 1001,
    "username": "doctor_zhang",
    "role": "doctor",
    "doctorTitle": "主治医师",
    "doctorDept": "内科",
    "certStatus": "approved"
  }
  ```
- ✅ 用户中心显示医生专属功能:
  - "医生资质"入口
  - "患者病历"入口
- ✅ 没有"申请成为医生"入口

---

### 测试用例5: 患者登录验证

**目的**: 验证患者注册后功能正常

**步骤**:
1. 使用测试用例1创建的患者账号登录
   - 用户名: `patient_test01`
   - 密码: `Test@123456`
2. 登录后进入用户中心

**预期结果**:
- ✅ 登录成功
- ✅ 返回的userInfo中role=`patient`
- ✅ 用户中心显示患者功能:
  - "我的病历"入口
- ✅ 没有"申请成为医生"入口(已废弃)

---

### 测试用例6: 重复用户名/邮箱验证

**目的**: 验证重复注册校验

**步骤A - 重复用户名**:
1. 尝试注册用户名为 `doctor_zhang` 的新账号

**预期结果**:
- ✅ 提示"用户名已存在"
- ✅ 注册失败

**步骤B - 重复邮箱**:
1. 尝试注册邮箱为 `zhang@hospital.com` 的新账号

**预期结果**:
- ✅ 提示"邮箱已被注册"
- ✅ 注册失败

---

### 测试用例7: 管理员界面验证

**目的**: 验证管理员不再看到医生申请审核功能

**步骤**:
1. 使用管理员账号登录
2. 进入用户中心

**预期结果**:
- ✅ 没有"医生申请审核"入口(已注释)
- ✅ 统计卡片不显示"待审核"数量
- ✅ 保留"用户管理"和"系统日志"功能

---

## 回归测试

### 问诊功能测试
1. 患者发起问诊 - ✅ 正常
2. 医生接诊 - ✅ 正常
3. 完成问诊 - ✅ 正常

### 病历功能测试
1. 患者查看病历 - ✅ 正常
2. 医生查看患者病历 - ✅ 正常

### 用户管理测试
1. 管理员查看用户列表 - ✅ 正常
2. 管理员禁用/启用用户 - ✅ 正常

---

## 数据库验证

### 验证患者数据
```sql
SELECT id, username, identify as role, real_name, doctor_title, cert_status 
FROM SM_user 
WHERE username = 'patient_test01';
```

**预期结果**:
- role = `patient`
- real_name = NULL (或空)
- doctor_title = NULL (或空)
- cert_status = NULL (或空)

### 验证医生数据
```sql
SELECT id, username, identify as role, real_name, doctor_title, 
       doctor_dept, specialty, cert_number, cert_status 
FROM SM_user 
WHERE username = 'doctor_zhang';
```

**预期结果**:
- role = `doctor`
- real_name = (SM4加密的"张医生")
- doctor_title = `主治医师`
- doctor_dept = `内科`
- specialty = `心血管疾病、高血压、糖尿病的诊治`
- cert_number = `DOC2024001`
- cert_status = `approved`

---

## 性能测试

### 批量注册测试
- 连续注册10个患者账号 - 验证响应时间
- 连续注册5个医生账号 - 验证加密性能

**预期**:
- 患者注册: < 500ms
- 医生注册: < 1000ms (包含加密多个敏感字段)

---

## 安全性验证

### 1. 密码加密
查看数据库password字段,确认:
- ✅ 不是明文存储
- ✅ 使用SM3哈希

### 2. 敏感信息加密
查看医生的real_name, id_card, phone, email字段,确认:
- ✅ 不是明文存储
- ✅ 使用SM4加密

### 3. SQL注入测试
尝试使用特殊字符注册:
- 用户名: `admin'--`
- 邮箱: `test@test.com'; DROP TABLE users;--`

**预期**:
- ✅ 不会造成SQL注入
- ✅ 正常处理或返回格式错误

---

## 故障模拟

### 网络中断测试
1. 填写注册表单
2. 断开网络
3. 提交注册

**预期**:
- ✅ 显示网络错误提示
- ✅ 不创建数据库记录

### 文件上传失败测试
1. 医生注册时上传超大图片(>10MB)

**预期**:
- ✅ 提示文件过大
- ✅ 或上传失败后正确处理

---

## 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: XXX

| 测试用例 | 测试结果 | 备注 |
|---------|---------|------|
| 患者注册 | ✅ 通过 | |
| 医生注册(完整) | ✅ 通过 | |
| 医生注册(必填验证) | ✅ 通过 | |
| 医生登录 | ✅ 通过 | |
| 患者登录 | ✅ 通过 | |
| 重复注册校验 | ✅ 通过 | |
| 管理员界面 | ✅ 通过 | |
| 问诊功能 | ✅ 通过 | |
| 病历功能 | ✅ 通过 | |
| 用户管理 | ✅ 通过 | |
| 数据加密 | ✅ 通过 | |

总结: 
- 通过: X/11
- 失败: X/11
- 阻塞问题: 无/有(描述)
```

---

## 已知问题

1. **证书上传**: 目前使用base64编码,建议后续对接文件上传服务
2. **身份验证**: 缺少实名认证,身份证号未做真实性校验

---

**文档版本**: v1.0  
**创建时间**: 2025-12-17
